<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz and Paragraph Practice</title>
  <style>
    /* General Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }

    /* Body Styling */
    body {
      background: linear-gradient(to bottom, #e6f7ff, #b3e0ff);
      color: #333;
      font-size: 1.1rem;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    /* Container */
    #app {
      background: #ffffff;
      width: 90%;
      max-width: 800px;
      margin: 20px auto;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    /* Buttons */
    button {
      background-color: #4da6ff;
      color: white;
      border: none;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }

    button:hover {
      background-color: #3399ff;
      transform: translateY(-2px);
    }

    button.gray-button {
      background-color: #cccccc;
      color: #333;
    }

    button.gray-button:hover {
      background-color: #bfbfbf;
    }

    #feedback, #paragraph-feedback {
      margin: 15px 0;
      font-size: 1.1rem;
      font-weight: bold;
      text-align: center;
    }

    .blank {
      display: inline-block;
      padding: 3px 8px;
      background-color: #f2f2f2;
      border: 1px dashed #ccc;
      border-radius: 5px;
      font-size: 1.1rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="questions-container"></div>
    <div id="feedback"></div>
    <div id="paragraph-container"></div>
    <div id="paragraph-feedback"></div>
    <button id="next-paragraph" style="display: none;">Next</button>
  </div>

  <script>
    // Variables
    let currentIndex = 0; // For quiz
    let paragraphIndex = 0; // For paragraphs
    let totalScore = 0;
    let paragraphCorrect = 0;
    let paragraphIncorrect = 0;
    let feedbackTimeout; // To manage clearing feedback timeout

    const questionPool = [
      {
        question: "What is 2 + 2?",
        correct: "4",
        options: ["3", "4", "5"],
        rationale: "2 + 2 equals 4.",
      },
      {
        question: "What is the capital of France?",
        correct: "Paris",
        options: ["London", "Berlin", "Paris"],
        rationale: "Paris is the capital of France.",
      },
    ];

    const paragraphPool = [
      {
        text: "The sun rises in the ___ and sets in the ___.",
        answers: ["east", "west"],
        options: ["north", "south", "east", "west"],
        rationales: [
          "The sun rises in the east.",
          "The sun sets in the west.",
        ],
      },
    ];

    // Shuffle Questions
    function shuffleQuestions(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // ========================= QUIZ SECTION =========================
    function loadQuestion() {
      const quizContainer = document.getElementById("questions-container");
      quizContainer.innerHTML = ""; // Clear previous content

      const feedback = document.getElementById("feedback");
      feedback.textContent = ""; // Clear feedback
      clearTimeout(feedbackTimeout); // Ensure previous timeout is cleared

      if (currentIndex >= questionPool.length) {
        showQuizResults();
        return;
      }

      const currentQuestion = questionPool[currentIndex];
      const questionText = document.createElement("p");
      questionText.textContent = currentQuestion.question;

      const optionsContainer = document.createElement("div");
      currentQuestion.options.forEach((option) => {
        const button = document.createElement("button");
        button.textContent = option;
        button.className = "quiz-button";
        button.addEventListener("click", () => evaluateAnswer(option, currentQuestion));
        optionsContainer.appendChild(button);
      });

      quizContainer.appendChild(questionText);
      quizContainer.appendChild(optionsContainer);

      if (!document.getElementById("grade-quiz")) {
        const gradeButton = document.createElement("button");
        gradeButton.textContent = "Grade Now";
        gradeButton.className = "quiz-button gray-button";
        gradeButton.id = "grade-quiz";
        gradeButton.addEventListener("click", showQuizResults);
        quizContainer.appendChild(gradeButton);
      }
    }

    function evaluateAnswer(selectedOption, question) {
      const feedback = document.getElementById("feedback");

      if (selectedOption === question.correct) {
        feedback.textContent = `Correct! ${question.rationale}`;
        feedback.style.color = "green";
        totalScore++;
      } else {
        feedback.textContent = `Incorrect. ${question.rationale}`;
        feedback.style.color = "red";
      }

      clearTimeout(feedbackTimeout); // Clear the previous timeout
      feedbackTimeout = setTimeout(() => {
        feedback.textContent = "";
      }, 3000);

      setTimeout(() => {
        currentIndex++;
        loadQuestion();
      }, 3000);
    }

    function showQuizResults() {
      const quizContainer = document.getElementById("questions-container");
      const percentage = Math.round((totalScore / questionPool.length) * 100);
      quizContainer.innerHTML = `
        <h2>Quiz Complete!</h2>
        <p>Your Score: <span style="color: green;">${totalScore}</span> / ${questionPool.length}</p>
        <p>Percentage: <span style="color: blue;">${percentage}%</span></p>
      `;
    }

    // ========================= PARAGRAPH SECTION =========================
    function loadParagraph() {
      const paragraphContainer = document.getElementById("paragraph-container");
      paragraphContainer.innerHTML = "";

      if (paragraphIndex >= paragraphPool.length) {
        showParagraphResults();
        return;
      }

      const currentParagraph = paragraphPool[paragraphIndex];
      const userAnswers = Array(currentParagraph.answers.length).fill("");

      const paragraphHTML = currentParagraph.text.split("___").map((part, i) => {
        if (i < currentParagraph.answers.length) {
          return `${part} <span class="blank" id="blank-${i}">___</span>`;
        }
        return part;
      }).join("");

      paragraphContainer.innerHTML = `<p>${paragraphHTML}</p>`;

      const optionsContainer = document.createElement("div");
      currentParagraph.options.forEach((option) => {
        const button = document.createElement("button");
        button.textContent = option;
        button.className = "paragraph-button";
        button.addEventListener("click", () => {
          for (let i = 0; i < userAnswers.length; i++) {
            if (!userAnswers[i]) {
              userAnswers[i] = option;
              const blankElement = document.getElementById(`blank-${i}`);
              blankElement.textContent = option;
              break;
            }
          }
        });
        optionsContainer.appendChild(button);
      });

      paragraphContainer.appendChild(optionsContainer);

      const gradeButton = document.createElement("button");
      gradeButton.textContent = "Grade Now";
      gradeButton.className = "gray-button";
      gradeButton.addEventListener("click", () => {
        evaluateParagraph(userAnswers, currentParagraph);
      });
      paragraphContainer.appendChild(gradeButton);
    }

    function evaluateParagraph(userAnswers, currentParagraph) {
      const paragraphContainer = document.getElementById("paragraph-container");
      const feedback = document.getElementById("paragraph-feedback");

      let correctCount = 0;
      userAnswers.forEach((answer, index) => {
        if (answer === currentParagraph.answers[index]) {
          correctCount++;
          document.getElementById(`blank-${index}`).style.color = "green";
        } else {
          document.getElementById(`blank-${index}`).style.color = "red";
        }
      });

      paragraphCorrect += correctCount;
      paragraphIncorrect += currentParagraph.answers.length - correctCount;

      if (correctCount === currentParagraph.answers.length) {
        feedback.textContent = "Correct!";
      } else {
        feedback.textContent = "Incorrect. Try again!";
      }

      paragraphIndex++;
      setTimeout(loadParagraph, 3000);
    }

    function showParagraphResults() {
      const paragraphContainer = document.getElementById("paragraph-container");
      paragraphContainer.innerHTML = `
        <h2>Paragraph Practice Complete!</h2>
        <p>Correct: ${paragraphCorrect}</p>
        <p>Incorrect: ${paragraphIncorrect}</p>
      `;
    }

    // Initialize
    document.addEventListener("DOMContentLoaded", () => {
      shuffleQuestions(questionPool);
      loadQuestion();
      loadParagraph();
    });
  </script>
</body>
</html>
